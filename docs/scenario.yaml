tags:
  name: Scenario
  description: Scenario endpoints

paths:
  /v1/scenario/user/me:
    get:
      summary: Get current user's scenarios
      description: Retrieves all scenarios created by the authenticated user
      tags:
        - Scenario
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully retrieved user's scenarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required

  /v1/scenario/user/{userId}:
    get:
      summary: Get scenarios by user ID
      description: Retrieves all scenarios created by a specific user
      tags:
        - Scenario
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: Successfully retrieved user's scenarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Scenario'

  /v1/scenario:
    post:
      summary: Create a new scenario
      description: Creates a new scenario for the authenticated user
      tags:
        - Scenario
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScenarioInput'
      responses:
        '200':
          description: Scenario successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '400':
          description: Bad request - Invalid input data or invalid model
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidModel:
                  value:
                    error: "Invalid model"
        '401':
          description: Unauthorized - Authentication required

  /v1/scenario/{scenarioId}:
    put:
      summary: Update a scenario
      description: Updates an existing scenario (only the creator can update)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScenarioInput'
      responses:
        '200':
          description: Scenario successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only edit your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only edit your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

    delete:
      summary: Delete a scenario
      description: Deletes an existing scenario (only the creator can delete)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      responses:
        '200':
          description: Scenario successfully deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only delete your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only delete your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
      required:
        - error
    ValidationError:
      type: object
      properties:
        errors:
          type: array
          description: An array of all validation errors 
      required:
        - errors

    ScenarioInput:
      type: object
      required:
        - title
        - category
        - status
        - objectives
        - persona
        - provider
        - model
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 130
          description: Scenario title
        subtitle:
          type: string
          minLength: 1
          maxLength: 200
          description: Scenario subtitle
        description:
          type: string
          minLength: 1
          maxLength: 512
          description: Scenario description
        category:
          type: string
          enum: [business, education, relationships, family, dates, public speaking]
          description: Scenario category
        tags:
          type: array
          minItems: 0
          maxItems: 5
          items:
            type: string
            minLength: 1
            maxLength: 50
          description: Scenario tags
        languages:
          type: array
          minItems: 1
          maxItems: 5
          items:
            type: string
          description: Supported language codes
        status:
          type: string
          enum: [editing, published, archived, deleted]
          description: Scenario status
        objectives:
          type: array
          minItems: 1
          maxItems: 5
          items:
            type: string
            minLength: 1
            maxLength: 200
          description: Learning objectives
        persona:
          type: string
          pattern: '^[a-fA-F0-9]{24}$'
          description: Persona ID (24-character hex string)
        openingPrompt:
          type: string
          description: Opening prompt for the scenario
        closingPrompt:
          type: string
          description: Closing prompt for the scenario
        provider:
          type: string
          description: AI provider
        model:
          type: string
          description: AI model name

    Scenario:
      allOf:
        - $ref: '#/components/schemas/ScenarioInput'
        - type: object
          properties:
            _id:
              type: string
              description: Scenario ID
            createdBy:
              type: string
              description: User ID of the creator
            lastUpdatedAt:
              type: string
              format: date-time
              description: Last update timestamp
            ai:
              type: object
              properties:
                provider:
                  type: string
                  description: AI provider
                model:
                  type: string
                  description: AI model name
            rounds:
              type: array
              items:
                type: object
              description: Scenario rounds data
            createdAt:
              type: string
              format: date-time
              description: Creation timestamp

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT