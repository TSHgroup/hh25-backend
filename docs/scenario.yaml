tags:
  name: Scenario
  description: Scenario endpoints

paths:
  /v1/scenario/user/me:
    get:
      summary: Get current user's scenarios
      description: Retrieves all scenarios created by the authenticated user
      tags:
        - Scenario
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully retrieved user's scenarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required

  /v1/scenario/user/{userId}:
    get:
      summary: Get scenarios by user ID
      description: Retrieves all public scenarios created by a specific user
      tags:
        - Scenario
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: Successfully retrieved user's scenarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Scenario'

  /v1/scenario:
    get:
      summary: Get all public scenarios (paginated)
      description: Retrieves a paginated list of all public scenarios
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          required: true
          schema:
            type: integer
            minimum: 1
          description: Page number
        - in: query
          name: limit
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: Successfully retrieved scenarios
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      $ref: '#/components/schemas/Scenario'
                  page:
                    type: integer
                    description: Current page number
                  limit:
                    type: integer
                    description: Number of items per page
                  lastPage:
                    type: integer
                    description: Last page number
                  firstPage:
                    type: integer
                    description: First page number (always 1)
                  size:
                    type: integer
                    description: Number of items in current page
        '400':
          description: Bad request - Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Unauthorized - Authentication required
    post:
      summary: Create a new scenario
      description: Creates a new scenario for the authenticated user
      tags:
        - Scenario
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScenarioInput'
      responses:
        '200':
          description: Scenario successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '400':
          description: Bad request - Invalid input data or invalid model
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Error'
                  - $ref: '#/components/schemas/ValidationError'
              examples:
                invalidModel:
                  value:
                    error: "Invalid model"
                validationError:
                  value:
                    errors:
                      - code: "invalid_type"
                        message: "Required"
                        path: ["title"]
        '401':
          description: Unauthorized - Authentication required

  /v1/scenario/{scenarioId}:
    get:
      summary: Get a scenario by ID
      description: Retrieves a specific scenario. Returns public scenarios or private scenarios owned by the authenticated user.
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      responses:
        '200':
          description: Successfully retrieved scenario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - This scenario is private
          content:
            application/json:
              schema:
               $ref: '#/components/schemas/Error'
              examples:
                private:
                  value:
                    error: "This scenario is private"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"
    put:
      summary: Update a scenario
      description: Updates an existing scenario (only the creator can update)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScenarioInput'
      responses:
        '200':
          description: Scenario successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only edit your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only edit your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

    delete:
      summary: Delete a scenario
      description: Deletes an existing scenario (only the creator can delete)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      responses:
        '200':
          description: Scenario successfully deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only delete your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only delete your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

  /v1/scenario/{scenarioId}/publish:
    post:
      summary: Publish a scenario
      description: Makes a scenario public (only the creator can publish)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      responses:
        '200':
          description: Scenario successfully published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only publish your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only publish your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

    delete:
      summary: Unpublish a scenario
      description: Makes a scenario private (only the creator can unpublish)
      tags:
        - Scenario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: scenarioId
          required: true
          schema:
            type: string
          description: Scenario ID
      responses:
        '200':
          description: Scenario successfully unpublished
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Scenario'
        '401':
          description: Unauthorized - Authentication required
        '403':
          description: Forbidden - You can only unpublish your own scenarios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                forbidden:
                  value:
                    error: "You can only unpublish your own scenarios"
        '404':
          description: Scenario not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                notFound:
                  value:
                    error: "Scenario not found"

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
      required:
        - error
    ValidationError:
      type: object
      properties:
        errors:
          type: array
          description: An array of all validation errors 
      required:
        - errors

    ScenarioInput:
      type: object
      required:
        - title
        - category
        - status
        - objectives
        - persona
        - provider
        - model
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 130
          description: Scenario title
        subtitle:
          type: string
          minLength: 1
          maxLength: 200
          description: Scenario subtitle
        description:
          type: string
          minLength: 1
          maxLength: 512
          description: Scenario description
        category:
          type: string
          enum: [business, education, relationships, family, dates, public speaking]
          description: Scenario category
        tags:
          type: array
          minItems: 0
          maxItems: 5
          items:
            type: string
            minLength: 1
            maxLength: 50
          description: Scenario tags
        languages:
          type: array
          minItems: 1
          maxItems: 5
          items:
            type: string
          description: Supported language codes
        status:
          type: string
          enum: [editing, published, archived, deleted]
          description: Scenario status
        objectives:
          type: array
          minItems: 1
          maxItems: 5
          items:
            type: string
            minLength: 1
            maxLength: 200
          description: Learning objectives
        persona:
          type: string
          pattern: '^[a-fA-F0-9]{24}$'
          description: Persona ID (24-character hex string)
        openingPrompt:
          type: string
          description: Opening prompt for the scenario
        closingPrompt:
          type: string
          description: Closing prompt for the scenario
        provider:
          type: string
          description: AI provider (e.g., "gemini")
        model:
          type: string
          description: AI model name (must be valid for the selected provider)

    Scenario:
      allOf:
        - $ref: '#/components/schemas/ScenarioInput'
        - type: object
          properties:
            _id:
              type: string
              description: Scenario ID
            createdBy:
              type: string
              description: User ID of the creator
            public:
              type: boolean
              description: Whether the scenario is publicly visible
            createdAt:
              type: string
              format: date-time
              description: Creation timestamp
            lastUpdatedAt:
              type: string
              format: date-time
              description: Last update timestamp
            ai:
              type: object
              properties:
                provider:
                  type: string
                  description: AI provider
                model:
                  type: string
                  description: AI model name
            rounds:
              type: array
              items:
                type: object
              description: Scenario rounds data

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT